var VAST=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParserUtils=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1);t.ParserUtils=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.util=new i.Util}return n(e,[{key:"childByName",value:function(e,t){var r=e.childNodes;for(var n in r){var i=r[n];if(i.nodeName===t)return i}}},{key:"childrenByName",value:function(e,t){var r=[],n=e.childNodes;for(var i in n){var a=n[i];a.nodeName===t&&r.push(a)}return r}},{key:"resolveVastAdTagURI",value:function(e,t){return t?0===e.indexOf("//")?""+location.protocol+e:-1===e.indexOf("://")?t.slice(0,t.lastIndexOf("/"))+"/"+e:e:e}},{key:"parseBoolean",value:function(e){return["true","TRUE","1"].includes(e)}},{key:"parseNodeText",value:function(e){return e&&(e.textContent||e.text||"").trim()}},{key:"copyNodeAttribute",value:function(e,t,r){var n=t.getAttribute(e);n&&r.setAttribute(e,n)}},{key:"parseDuration",value:function(e){if(null==e)return-1;if(this.util.isNumeric(e))return parseInt(e);var t=e.split(":");if(3!==t.length)return-1;var r=t[2].split("."),n=parseInt(r[0]);2===r.length&&(n+=parseFloat("0."+r[1]));var i=parseInt(60*t[1]),a=parseInt(60*t[0]*60);return isNaN(a)||isNaN(i)||isNaN(n)||i>3600||n>60?-1:a+i+n}},{key:"splitVAST",value:function(e){var t=[],r=null;return e.forEach(function(n,i){if(n.sequence&&(n.sequence=parseInt(n.sequence,10)),n.sequence>1){var a=e[i-1];if(a&&a.sequence===n.sequence-1)return void(r&&r.push(n));delete n.sequence}r=[n],t.push(r)}),t}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Util=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"track",value:function(e,t){this.resolveURLTemplates(e,t).forEach(function(e){"undefined"!=typeof window&&null!==window&&((new Image).src=e)})}},{key:"resolveURLTemplates",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[];for(var n in t.ASSETURI&&(t.ASSETURI=this.encodeURIComponentRFC3986(t.ASSETURI)),t.CONTENTPLAYHEAD&&(t.CONTENTPLAYHEAD=this.encodeURIComponentRFC3986(t.CONTENTPLAYHEAD)),t.ERRORCODE&&!/^[0-9]{3}$/.test(t.ERRORCODE)&&(t.ERRORCODE=900),t.CACHEBUSTING=this.leftpad(Math.round(1e8*Math.random()).toString()),t.TIMESTAMP=this.encodeURIComponentRFC3986((new Date).toISOString()),t.RANDOM=t.random=t.CACHEBUSTING,e){var i=e[n];if(i){for(var a in t){var s=t[a],o="["+a+"]",l="%%"+a+"%%";i=(i=i.replace(o,s)).replace(l,s)}r.push(i)}}return r}},{key:"encodeURIComponentRFC3986",value:function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}},{key:"leftpad",value:function(e){return e.length<8?this.range(0,8-e.length,!1).map(function(e){return"0"}).join("")+e:e}},{key:"range",value:function(e,t,r){for(var n=[],i=e<t,a=r?i?t+1:t-1:t,s=e;i?s<a:s>a;i?s++:s--)n.push(s);return n}},{key:"isNumeric",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"flatten",value:function(e){var t=this;return e.reduce(function(e,r){return e.concat(Array.isArray(r)?t.flatten(r):r)},[])}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Creative=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id||null,this.adId=t.adId||null,this.sequence=t.sequence||null,this.apiFramework=t.apiFramework||null,this.trackingEvents={}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VASTParser=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(9),s=r(7),o=r(0),l=r(20),u=r(1),c=r(24);var p={ERRORCODE:900,extensions:[]};t.VASTParser=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.remainingAds=[],e.parentURLs=[],e.errorURLTemplates=[],e.rootErrorURLTemplates=[],e.maxWrapperDepth=null,e.URLTemplateFilters=[],e.fetchingOptions={},e.parserUtils=new o.ParserUtils,e.adParser=new a.AdParser,e.util=new u.Util,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventEmitter),i(t,[{key:"addURLTemplateFilter",value:function(e){"function"==typeof e&&this.URLTemplateFilters.push(e)}},{key:"removeURLTemplateFilter",value:function(){this.URLTemplateFilters.pop()}},{key:"countURLTemplateFilters",value:function(){return this.URLTemplateFilters.length}},{key:"clearURLTemplateFilters",value:function(){this.URLTemplateFilters=[]}},{key:"trackVastError",value:function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];this.emit("VAST-error",n.apply(void 0,[p,t].concat(i))),this.util.track(e,t)}},{key:"getErrorURLTemplates",value:function(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}},{key:"fetchVAST",value:function(e){var t=this;return new Promise(function(r,n){t.URLTemplateFilters.forEach(function(t){e=t(e)}),t.parentURLs.push(e),t.emit("VAST-resolving",{url:e}),t.urlHandler.get(e,t.fetchingOptions,function(i,a){t.emit("VAST-resolved",{url:e}),i?n(i):r(a)})})}},{key:"initParsingStatus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.rootURL="",this.remainingAds=[],this.parentURLs=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.maxWrapperDepth=e.wrapperLimit||10,this.fetchingOptions={timeout:e.timeout,withCredentials:e.withCredentials},this.urlHandler=e.urlhandler||new l.URLHandler}},{key:"getRemainingAds",value:function(e){var t=this;return new Promise(function(r,n){if(0===t.remainingAds.length)return n(new Error("No more ads are available for the given VAST"));var i=e?t.util.flatten(t.remainingAds):t.remainingAds.shift();t.errorURLTemplates=[],t.parentURLs=[],t.resolveAds(i,{wrapperDepth:0,originalUrl:t.rootURL}).then(function(e){var n=t.buildVASTResponse(e);r(n)}).catch(function(e){return n(e)})})}},{key:"getAndParseVAST",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),this.rootURL=e,new Promise(function(n,i){t.fetchVAST(e).then(function(a){r.originalUrl=e,r.isRootVAST=!0,t.parse(a,r).then(function(e){var r=t.buildVASTResponse(e);n(r)}).catch(function(e){return i(e)})}).catch(function(e){return i(e)})})}},{key:"parseVAST",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),new Promise(function(n,i){r.isRootVAST=!0,t.parse(e,r).then(function(e){var r=t.buildVASTResponse(e);n(r)}).catch(function(e){return i(e)})})}},{key:"buildVASTResponse",value:function(e){var t=new c.VASTResponse;return t.ads=e,t.errorURLTemplates=this.getErrorURLTemplates(),this.completeWrapperResolving(t),t}},{key:"parse",value:function(e,t){var r=this,n=t.resolveAll,i=void 0===n||n,a=t.wrapperSequence,s=void 0===a?null:a,o=t.originalUrl,l=void 0===o?null:o,u=t.wrapperDepth,c=void 0===u?0:u,p=t.isRootVAST,h=void 0!==p&&p;return new Promise(function(t,n){if(!e||!e.documentElement||"VAST"!==e.documentElement.nodeName)return n(new Error("Invalid VAST XMLDocument"));var a=[],o=e.documentElement.childNodes;for(var u in o){var p=o[u];if("Error"===p.nodeName){var f=r.parserUtils.parseNodeText(p);h?r.rootErrorURLTemplates.push(f):r.errorURLTemplates.push(f)}if("Ad"===p.nodeName){var d=r.adParser.parse(p);d?a.push(d):r.trackVastError(r.getErrorURLTemplates(),{ERRORCODE:101})}}var v=a.length,m=a[v-1];1===v&&void 0!==s&&null!==s&&m&&!m.sequence&&(m.sequence=s),!1===i&&(r.remainingAds=r.parserUtils.splitVAST(a),a=r.remainingAds.shift()),r.resolveAds(a,{resolveAll:i,wrapperDepth:c,originalUrl:l}).then(function(e){return t(e)}).catch(function(e){return n(e)})})}},{key:"resolveAds",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1],n=r.wrapperDepth,i=r.originalUrl;return new Promise(function(r,a){var s=[];t.forEach(function(t){var r=e.resolveWrappers(t,n,i);s.push(r)}),r(Promise.all(s).then(function(t){return e.util.flatten(t)}))}).then(function(t){if(!t&&e.remainingAds.length>0){var r=e.remainingAds.shift();return e.resolveAds(r,{wrapperDepth:n,originalUrl:i})}return t})}},{key:"resolveWrappers",value:function(e,t,r){var n=this;return new Promise(function(i,a){if(t++,!e.nextWrapperURL)return delete e.nextWrapperURL,i(e);if(t>=n.maxWrapperDepth||n.parentURLs.includes(e.nextWrapperURL))return e.errorCode=302,delete e.nextWrapperURL,i(e);e.nextWrapperURL=n.parserUtils.resolveVastAdTagURI(e.nextWrapperURL,r);var s=e.sequence;r=e.nextWrapperURL,n.fetchVAST(e.nextWrapperURL).then(function(a){n.parse(a,{originalUrl:r,wrapperSequence:s,wrapperDepth:t}).then(function(t){if(delete e.nextWrapperURL,0===t.length)return e.creatives=[],i(e);t.forEach(function(t){t&&n.mergeWrapperAdData(t,e)}),i(t)}).catch(function(t){e.errorCode=301,e.errorMessage=t.message,i(e)})}).catch(function(e){return a(e)})})}},{key:"completeWrapperResolving",value:function(e){if(0===e.ads.length)this.trackVastError(e.errorURLTemplates,{ERRORCODE:303});else for(var t=e.ads.length-1;t>=0;t--){var r=e.ads[t];(r.errorCode||0===r.creatives.length)&&(this.trackVastError(r.errorURLTemplates.concat(e.errorURLTemplates),{ERRORCODE:r.errorCode||303},{ERRORMESSAGE:r.errorMessage||""},{extensions:r.extensions},{system:r.system}),e.ads.splice(t,1))}}},{key:"mergeWrapperAdData",value:function(e,t){e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),e.creatives.forEach(function(e){if(t.trackingEvents&&t.trackingEvents[e.type])for(var r in t.trackingEvents[e.type]){var n=t.trackingEvents[e.type][r];e.trackingEvents[r]||(e.trackingEvents[r]=[]),e.trackingEvents[r]=e.trackingEvents[r].concat(n)}}),t.videoClickTrackingURLTemplates&&t.videoClickTrackingURLTemplates.length&&e.creatives.forEach(function(e){"linear"===e.type&&(e.videoClickTrackingURLTemplates=e.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates))}),t.videoCustomClickURLTemplates&&t.videoCustomClickURLTemplates.length&&e.creatives.forEach(function(e){"linear"===e.type&&(e.videoCustomClickURLTemplates=e.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates))}),t.videoClickThroughURLTemplate&&e.creatives.forEach(function(e){"linear"===e.type&&null==e.videoClickThroughURLTemplate&&(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate)})}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CompanionAd=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreativeLinear=void 0;var n=r(2);t.CreativeLinear=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type="linear",r.duration=0,r.skipDelay=null,r.mediaFiles=[],r.videoClickThroughURLTemplate=null,r.videoClickTrackingURLTemplates=[],r.videoCustomClickURLTemplates=[],r.adParameters=null,r.icons=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Creative),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NonLinearAd=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null}},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,s,o,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(i(r))for(o=Array.prototype.slice.call(arguments,1),s=(u=r.slice()).length,l=0;l<s;l++)u[l].apply(this,o);return!0},r.prototype.addListener=function(e,t){var s;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(s=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},r.prototype.removeListener=function(e,t){var r,a,s,o;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,a=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(o=s;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){a=o;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VASTTracker=t.VASTParser=t.VASTClient=void 0;var n=r(3),i=r(25),a=r(27);t.VASTClient=i.VASTClient,t.VASTParser=n.VASTParser,t.VASTTracker=a.VASTTracker},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdParser=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(10),a=r(11),s=r(12),o=r(13),l=r(15),u=r(18),c=r(0);t.AdParser=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.creativeCompanionParser=new o.CreativeCompanionParser,this.creativeNonLinearParser=new u.CreativeNonLinearParser,this.creativeLinearParser=new l.CreativeLinearParser,this.parserUtils=new c.ParserUtils}return n(e,[{key:"parse",value:function(e){var t=e.childNodes;for(var r in t){var n=t[r];if(["Wrapper","InLine"].includes(n.nodeName)){if(this.parserUtils.copyNodeAttribute("id",e,n),this.parserUtils.copyNodeAttribute("sequence",e,n),"Wrapper"===n.nodeName)return this.parseWrapper(n);if("InLine"===n.nodeName)return this.parseInLine(n)}}}},{key:"parseInLine",value:function(e){var t=this,r=e.childNodes,n=new i.Ad;for(var a in n.id=e.getAttribute("id")||null,n.sequence=e.getAttribute("sequence")||null,r){var s=r[a];switch(s.nodeName){case"Error":n.errorURLTemplates.push(this.parserUtils.parseNodeText(s));break;case"Impression":n.impressionURLTemplates.push(this.parserUtils.parseNodeText(s));break;case"Creatives":this.parserUtils.childrenByName(s,"Creative").forEach(function(e){var r={id:e.getAttribute("id")||null,adId:t.parseCreativeAdIdAttribute(e),sequence:e.getAttribute("sequence")||null,apiFramework:e.getAttribute("apiFramework")||null};for(var i in e.childNodes){var a=e.childNodes[i];switch(a.nodeName){case"Linear":var s=t.creativeLinearParser.parse(a,r);s&&n.creatives.push(s);break;case"NonLinearAds":var o=t.creativeNonLinearParser.parse(a,r);o&&n.creatives.push(o);break;case"CompanionAds":var l=t.creativeCompanionParser.parse(a,r);l&&n.creatives.push(l)}}});break;case"Extensions":this.parseExtensions(n.extensions,this.parserUtils.childrenByName(s,"Extension"));break;case"AdSystem":n.system={value:this.parserUtils.parseNodeText(s),version:s.getAttribute("version")||null};break;case"AdTitle":n.title=this.parserUtils.parseNodeText(s);break;case"Description":n.description=this.parserUtils.parseNodeText(s);break;case"Advertiser":n.advertiser=this.parserUtils.parseNodeText(s);break;case"Pricing":n.pricing={value:this.parserUtils.parseNodeText(s),model:s.getAttribute("model")||null,currency:s.getAttribute("currency")||null};break;case"Survey":n.survey=this.parserUtils.parseNodeText(s)}}return n}},{key:"parseWrapper",value:function(e){var t=this.parseInLine(e),r=this.parserUtils.childByName(e,"VASTAdTagURI");if(r?t.nextWrapperURL=this.parserUtils.parseNodeText(r):(r=this.parserUtils.childByName(e,"VASTAdTagURL"))&&(t.nextWrapperURL=this.parserUtils.parseNodeText(this.parserUtils.childByName(r,"URL"))),t.creatives.forEach(function(e){if(["linear","nonlinear"].includes(e.type)){if(e.trackingEvents){t.trackingEvents||(t.trackingEvents={}),t.trackingEvents[e.type]||(t.trackingEvents[e.type]={});var r=function(r){var n=e.trackingEvents[r];t.trackingEvents[e.type][r]||(t.trackingEvents[e.type][r]=[]),n.forEach(function(n){t.trackingEvents[e.type][r].push(n)})};for(var n in e.trackingEvents)r(n)}e.videoClickTrackingURLTemplates&&(t.videoClickTrackingURLTemplates||(t.videoClickTrackingURLTemplates=[]),e.videoClickTrackingURLTemplates.forEach(function(e){t.videoClickTrackingURLTemplates.push(e)})),e.videoClickThroughURLTemplate&&(t.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate),e.videoCustomClickURLTemplates&&(t.videoCustomClickURLTemplates||(t.videoCustomClickURLTemplates=[]),e.videoCustomClickURLTemplates.forEach(function(e){t.videoCustomClickURLTemplates.push(e)}))}}),t.nextWrapperURL)return t}},{key:"parseExtensions",value:function(e,t){var r=this;t.forEach(function(t){var n=new a.AdExtension,i=t.attributes,o=t.childNodes;if(t.attributes)for(var l in i){var u=i[l];u.nodeName&&u.nodeValue&&(n.attributes[u.nodeName]=u.nodeValue)}for(var c in o){var p=o[c],h=r.parserUtils.parseNodeText(p);if("#comment"!==p.nodeName&&""!==h){var f=new s.AdExtensionChild;if(f.name=p.nodeName,f.value=h,p.attributes){var d=p.attributes;for(var v in d){var m=d[v];f.attributes[m.nodeName]=m.nodeValue}}n.children.push(f)}}e.push(n)})}},{key:"parseCreativeAdIdAttribute",value:function(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Ad=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AdExtension=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.attributes={},this.children=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AdExtensionChild=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=null,this.value=null,this.attributes={}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreativeCompanionParser=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=r(14),s=r(0);t.CreativeCompanionParser=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parserUtils=new s.ParserUtils}return n(e,[{key:"parse",value:function(e,t){var r=this,n=new a.CreativeCompanion(t);return this.parserUtils.childrenByName(e,"Companion").forEach(function(e){var t=new i.CompanionAd;t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.companionClickTrackingURLTemplates=[],r.parserUtils.childrenByName(e,"HTMLResource").forEach(function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=r.parserUtils.parseNodeText(e)}),r.parserUtils.childrenByName(e,"IFrameResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=r.parserUtils.parseNodeText(e)}),r.parserUtils.childrenByName(e,"StaticResource").forEach(function(n){t.type=n.getAttribute("creativeType")||0,r.parserUtils.childrenByName(e,"AltText").forEach(function(e){t.altText=r.parserUtils.parseNodeText(e)}),t.staticResource=r.parserUtils.parseNodeText(n)}),r.parserUtils.childrenByName(e,"TrackingEvents").forEach(function(e){r.parserUtils.childrenByName(e,"Tracking").forEach(function(e){var n=e.getAttribute("event"),i=r.parserUtils.parseNodeText(e);n&&i&&(null==t.trackingEvents[n]&&(t.trackingEvents[n]=[]),t.trackingEvents[n].push(i))})}),r.parserUtils.childrenByName(e,"CompanionClickTracking").forEach(function(e){t.companionClickTrackingURLTemplates.push(r.parserUtils.parseNodeText(e))}),t.companionClickThroughURLTemplate=r.parserUtils.parseNodeText(r.parserUtils.childByName(e,"CompanionClickThrough")),t.companionClickTrackingURLTemplate=r.parserUtils.parseNodeText(r.parserUtils.childByName(e,"CompanionClickTracking")),n.variations.push(t)}),n}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreativeCompanion=void 0;var n=r(2);t.CreativeCompanion=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type="companion",r.variations=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Creative),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreativeLinearParser=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(5),a=r(16),s=r(17),o=r(0);t.CreativeLinearParser=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parserUtils=new o.ParserUtils}return n(e,[{key:"parse",value:function(e,t){var r=this,n=void 0,o=new i.CreativeLinear(t);o.duration=this.parserUtils.parseDuration(this.parserUtils.parseNodeText(this.parserUtils.childByName(e,"Duration")));var l=e.getAttribute("skipoffset");if(null==l)o.skipDelay=null;else if("%"===l.charAt(l.length-1)&&-1!==o.duration){var u=parseInt(l,10);o.skipDelay=o.duration*(u/100)}else o.skipDelay=this.parserUtils.parseDuration(l);var c=this.parserUtils.childByName(e,"VideoClicks");c&&(o.videoClickThroughURLTemplate=this.parserUtils.parseNodeText(this.parserUtils.childByName(c,"ClickThrough")),this.parserUtils.childrenByName(c,"ClickTracking").forEach(function(e){o.videoClickTrackingURLTemplates.push(r.parserUtils.parseNodeText(e))}),this.parserUtils.childrenByName(c,"CustomClick").forEach(function(e){o.videoCustomClickURLTemplates.push(r.parserUtils.parseNodeText(e))}));var p=this.parserUtils.childByName(e,"AdParameters");p&&(o.adParameters=this.parserUtils.parseNodeText(p)),this.parserUtils.childrenByName(e,"TrackingEvents").forEach(function(e){r.parserUtils.childrenByName(e,"Tracking").forEach(function(e){var t=e.getAttribute("event"),i=r.parserUtils.parseNodeText(e);if(t&&i){if("progress"===t){if(!(n=e.getAttribute("offset")))return;t="%"===n.charAt(n.length-1)?"progress-"+n:"progress-"+Math.round(r.parserUtils.parseDuration(n))}null==o.trackingEvents[t]&&(o.trackingEvents[t]=[]),o.trackingEvents[t].push(i)}})}),this.parserUtils.childrenByName(e,"MediaFiles").forEach(function(e){r.parserUtils.childrenByName(e,"MediaFile").forEach(function(e){var t=new s.MediaFile;t.id=e.getAttribute("id"),t.fileURL=r.parserUtils.parseNodeText(e),t.deliveryType=e.getAttribute("delivery"),t.codec=e.getAttribute("codec"),t.mimeType=e.getAttribute("type"),t.apiFramework=e.getAttribute("apiFramework"),t.bitrate=parseInt(e.getAttribute("bitrate")||0),t.minBitrate=parseInt(e.getAttribute("minBitrate")||0),t.maxBitrate=parseInt(e.getAttribute("maxBitrate")||0),t.width=parseInt(e.getAttribute("width")||0),t.height=parseInt(e.getAttribute("height")||0);var n=e.getAttribute("scalable");n&&"string"==typeof n&&("true"===(n=n.toLowerCase())?t.scalable=!0:"false"===n&&(t.scalable=!1));var i=e.getAttribute("maintainAspectRatio");i&&"string"==typeof i&&("true"===(i=i.toLowerCase())?t.maintainAspectRatio=!0:"false"===i&&(t.maintainAspectRatio=!1)),o.mediaFiles.push(t)})});var h=this.parserUtils.childByName(e,"Icons");return h&&this.parserUtils.childrenByName(h,"Icon").forEach(function(e){var t=new a.Icon;t.program=e.getAttribute("program"),t.height=parseInt(e.getAttribute("height")||0),t.width=parseInt(e.getAttribute("width")||0),t.xPosition=r.parseXPosition(e.getAttribute("xPosition")),t.yPosition=r.parseYPosition(e.getAttribute("yPosition")),t.apiFramework=e.getAttribute("apiFramework"),t.offset=r.parserUtils.parseDuration(e.getAttribute("offset")),t.duration=r.parserUtils.parseDuration(e.getAttribute("duration")),r.parserUtils.childrenByName(e,"HTMLResource").forEach(function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=r.parserUtils.parseNodeText(e)}),r.parserUtils.childrenByName(e,"IFrameResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=r.parserUtils.parseNodeText(e)}),r.parserUtils.childrenByName(e,"StaticResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.staticResource=r.parserUtils.parseNodeText(e)});var n=r.parserUtils.childByName(e,"IconClicks");n&&(t.iconClickThroughURLTemplate=r.parserUtils.parseNodeText(r.parserUtils.childByName(n,"IconClickThrough")),r.parserUtils.childrenByName(n,"IconClickTracking").forEach(function(e){t.iconClickTrackingURLTemplates.push(r.parserUtils.parseNodeText(e))})),t.iconViewTrackingURLTemplate=r.parserUtils.parseNodeText(r.parserUtils.childByName(e,"IconViewTracking")),o.icons.push(t)}),o}},{key:"parseXPosition",value:function(e){return["left","right"].includes(e)?e:parseInt(e||0)}},{key:"parseYPosition",value:function(e){return["top","bottom"].includes(e)?e:parseInt(e||0)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Icon=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MediaFile=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreativeNonLinearParser=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(19),a=r(6),s=r(0);t.CreativeNonLinearParser=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parserUtils=new s.ParserUtils}return n(e,[{key:"parse",value:function(e,t){var r=this,n=new i.CreativeNonLinear(t);return this.parserUtils.childrenByName(e,"TrackingEvents").forEach(function(e){var t=void 0,i=void 0;r.parserUtils.childrenByName(e,"Tracking").forEach(function(e){t=e.getAttribute("event"),i=r.parserUtils.parseNodeText(e),t&&i&&(null==n.trackingEvents[t]&&(n.trackingEvents[t]=[]),n.trackingEvents[t].push(i))})}),this.parserUtils.childrenByName(e,"NonLinear").forEach(function(e){var t=new a.NonLinearAd;t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.expandedWidth=e.getAttribute("expandedWidth"),t.expandedHeight=e.getAttribute("expandedHeight"),t.scalable=r.parserUtils.parseBoolean(e.getAttribute("scalable")),t.maintainAspectRatio=r.parserUtils.parseBoolean(e.getAttribute("maintainAspectRatio")),t.minSuggestedDuration=r.parserUtils.parseDuration(e.getAttribute("minSuggestedDuration")),t.apiFramework=e.getAttribute("apiFramework"),r.parserUtils.childrenByName(e,"HTMLResource").forEach(function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=r.parserUtils.parseNodeText(e)}),r.parserUtils.childrenByName(e,"IFrameResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=r.parserUtils.parseNodeText(e)}),r.parserUtils.childrenByName(e,"StaticResource").forEach(function(e){t.type=e.getAttribute("creativeType")||0,t.staticResource=r.parserUtils.parseNodeText(e)});var i=r.parserUtils.childByName(e,"AdParameters");i&&(t.adParameters=r.parserUtils.parseNodeText(i)),t.nonlinearClickThroughURLTemplate=r.parserUtils.parseNodeText(r.parserUtils.childByName(e,"NonLinearClickThrough")),r.parserUtils.childrenByName(e,"NonLinearClickTracking").forEach(function(e){t.nonlinearClickTrackingURLTemplates.push(r.parserUtils.parseNodeText(e))}),n.variations.push(t)}),n}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreativeNonLinear=void 0;var n=r(2);t.CreativeNonLinear=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type="nonlinear",r.variations=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Creative),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URLHandler=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(21),a=r(22),s=r(23);t.URLHandler=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.flash=new i.FlashURLHandler,this.node=new a.NodeURLHandler,this.xhr=new s.XHRURLHandler}return n(e,[{key:"get",value:function(e,t,r){if(r||("function"==typeof t&&(r=t),t={}),t.response){var n=t.response;return delete t.response,r(null,n)}return t.urlhandler&&t.urlhandler.supported()?t.urlhandler.get(e,t,r):"undefined"==typeof window||null===window?this.node.get(e,t,r):this.xhr.supported()?this.xhr.get(e,t,r):this.flash.supported()?this.flash.get(e,t,r):r(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.FlashURLHandler=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"xdr",value:function(){var e=void 0;return window.XDomainRequest&&(e=new XDomainRequest),e}},{key:"supported",value:function(){return!!this.xdr()}},{key:"get",value:function(e,t,r){var n="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0;if(!n)return r(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"));n.async=!1;var i=this.xdr();i.open("GET",e),i.timeout=t.timeout||0,i.withCredentials=t.withCredentials||!1,i.send(),i.onprogress=function(){},i.onload=function(){n.loadXML(i.responseText),r(null,n)}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.NodeURLHandler=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"get",value:function(e,t,r){r(new Error("Please bundle the library for node to use the node urlHandler"))}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.XHRURLHandler=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"xhr",value:function(){var e=new window.XMLHttpRequest;if("withCredentials"in e)return e}},{key:"supported",value:function(){return!!this.xhr()}},{key:"get",value:function(e,t,r){if("https:"===window.location.protocol&&0===e.indexOf("http://"))return r(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{var n=this.xhr();n.open("GET",e),n.timeout=t.timeout||0,n.withCredentials=t.withCredentials||!1,n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?r(null,n.responseXML):r(new Error("XHRURLHandler: "+n.statusText)))},n.send()}catch(e){r(new Error("XHRURLHandler: Unexpected error"))}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VASTResponse=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ads=[],this.errorURLTemplates=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VASTClient=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(26),s=r(1),o=r(3);t.VASTClient=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cappingFreeLunch=t||0,this.cappingMinimumTimeInterval=r||0,this.defaultOptions={withCredentials:!1,timeout:0},this.vastParser=new o.VASTParser,this.util=new s.Util,this.storage=n||new a.Storage,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}return i(e,[{key:"getParser",value:function(){return this.vastParser}},{key:"hasRemainingAds",value:function(){return this.vastParser.remainingAds.length>0}},{key:"getNextAds",value:function(e){return this.vastParser.getRemainingAds(e)}},{key:"get",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Date.now();return(r=n(this.defaultOptions,r)).hasOwnProperty("resolveAll")||(r.resolveAll=!1),this.totalCallsTimeout<i?(this.totalCalls=1,this.totalCallsTimeout=i+36e5):this.totalCalls++,new Promise(function(n,a){if(t.cappingFreeLunch>=t.totalCalls)return a(new Error("VAST call canceled – FreeLunch capping not reached yet "+t.totalCalls+"/"+t.cappingFreeLunch));var s=i-t.lastSuccessfulAd;if(s<0)t.lastSuccessfulAd=0;else if(s<t.cappingMinimumTimeInterval)return a(new Error("VAST call canceled – ("+t.cappingMinimumTimeInterval+")ms minimum interval reached"));t.vastParser.getAndParseVAST(e,r).then(function(e){return n(e)}).catch(function(e){return a(e)})})}},{key:"lastSuccessfulAd",get:function(){return this.storage.getItem("vast-client-last-successful-ad")},set:function(e){this.storage.setItem("vast-client-last-successful-ad",e)}},{key:"totalCalls",get:function(){return this.storage.getItem("vast-client-total-calls")},set:function(e){this.storage.setItem("vast-client-total-calls",e)}},{key:"totalCallsTimeout",get:function(){return this.storage.getItem("vast-client-total-calls-timeout")},set:function(e){this.storage.setItem("vast-client-total-calls-timeout",e)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=null,a={data:{},length:0,getItem:function(e){return this.data[e]},setItem:function(e,t){this.data[e]=t,this.length=Object.keys(this.data).length},removeItem:function(e){delete data[e],this.length=Object.keys(this.data).length},clear:function(){this.data={},this.length=0}};t.Storage=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=this.initStorage()}return n(e,[{key:"initStorage",value:function(){if(i)return i;try{i="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){i=null}return i&&!this.isStorageDisabled(i)||(i=a).clear(),i}},{key:"isStorageDisabled",value:function(e){var t="__VASTStorage__";try{if(e.setItem(t,t),e.getItem(t)!==t)return e.removeItem(t),!0}catch(e){return!0}return e.removeItem(t),!1}},{key:"getItem",value:function(e){return this.storage.getItem(e)}},{key:"setItem",value:function(e,t){return this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){return this.storage.removeItem(e)}},{key:"clear",value:function(){return this.storage.clear()}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VASTTracker=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=r(5),s=r(7),o=r(6),l=r(1);t.VASTTracker=function(e){function t(e,r,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));for(var c in u.ad=r,u.creative=n,u.variation=s,u.util=new l.Util,u.muted=!1,u.impressed=!1,u.skippable=!1,u.skipDelayDefault=-1,u.trackingEvents={},u.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],u._alreadyTriggeredQuartiles={},u.creative.trackingEvents){var p=u.creative.trackingEvents[c];u.trackingEvents[c]=p.slice(0)}return u.creative instanceof a.CreativeLinear?(u.setDuration(u.creative.duration),u.skipDelay=u.creative.skipDelay,u.linear=!0,u.clickThroughURLTemplate=u.creative.videoClickThroughURLTemplate,u.clickTrackingURLTemplates=u.creative.videoClickTrackingURLTemplates):(u.skipDelay=-1,u.linear=!1,u.variation&&(u.variation instanceof o.NonLinearAd?(u.clickThroughURLTemplate=u.variation.nonlinearClickThroughURLTemplate,u.clickTrackingURLTemplates=u.variation.nonlinearClickTrackingURLTemplates):u.variation instanceof i.CompanionAd&&(u.clickThroughURLTemplate=u.variation.companionClickThroughURLTemplate,u.clickTrackingURLTemplates=u.variation.companionClickTrackingURLTemplates))),e&&u.on("start",function(){e.lastSuccessfullAd=Date.now()}),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventEmitter),n(t,[{key:"setDuration",value:function(e){this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}}},{key:"setProgress",value:function(e){var t=this,r=this.skipDelay||this.skipDelayDefault;if(-1===r||this.skippable||(r>e?this.emit("skip-countdown",r-e):(this.skippable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){var n=[];if(e>0){var i=Math.round(e/this.assetDuration*100);for(var a in n.push("start"),n.push("progress-"+i+"%"),n.push("progress-"+Math.round(e)),this.quartiles)this.isQuartileReached(a,this.quartiles[a],e)&&(n.push(a),this._alreadyTriggeredQuartiles[a]=!0)}n.forEach(function(e){t.track(e,!0)}),e<this.progress&&this.track("rewind")}this.progress=e}},{key:"isQuartileReached",value:function(e,t,r){var n=!1;return t<=r&&!this._alreadyTriggeredQuartiles[e]&&(n=!0),n}},{key:"setMuted",value:function(e){this.muted!==e&&this.track(e?"mute":"unmute"),this.muted=e}},{key:"setPaused",value:function(e){this.paused!==e&&this.track(e?"pause":"resume"),this.paused=e}},{key:"setFullscreen",value:function(e){this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen"),this.fullscreen=e}},{key:"setExpand",value:function(e){this.expanded!==e&&this.track(e?"expand":"collapse"),this.expanded=e}},{key:"setSkipDelay",value:function(e){"number"==typeof e&&(this.skipDelay=e)}},{key:"trackImpression",value:function(){this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView"))}},{key:"errorWithCode",value:function(e){this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:e})}},{key:"complete",value:function(){this.track("complete")}},{key:"close",value:function(){this.track(this.linear?"closeLinear":"close")}},{key:"skip",value:function(){this.track("skip"),this.trackingEvents=[]}},{key:"click",value:function(){if(this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates),this.clickThroughURLTemplate){var e=this.linear?{CONTENTPLAYHEAD:this.progressFormatted()}:{},t=this.util.resolveURLTemplates([this.clickThroughURLTemplate],e)[0];this.emit("clickthrough",t)}}},{key:"track",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"closeLinear"===e&&!this.trackingEvents[e]&&this.trackingEvents.close&&(e="close");var r=this.trackingEvents[e],n=this.emitAlwaysEvents.indexOf(e)>-1;r?(this.emit(e,""),this.trackURLs(r)):n&&this.emit(e,""),t&&(delete this.trackingEvents[e],n&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(e),1))}},{key:"trackURLs",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(t.ASSETURI=this.creative.mediaFiles[0].fileURL),t.CONTENTPLAYHEAD=this.progressFormatted()),this.util.track(e,t)}},{key:"progressFormatted",value:function(){var e=parseInt(this.progress),t=e/3600;t.length<2&&(t="0"+t);var r=e/60%60;r.length<2&&(r="0"+r);var n=e%60;return n.length<2&&(n="0"+r),t+":"+r+":"+n+"."+parseInt(100*(this.progress-e))}}]),t}()}]);